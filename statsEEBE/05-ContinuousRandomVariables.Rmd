# Variables aleatorias continuas

## Objetivo


En este capítulo estudiaremos variables aleatorias continuas.

Definiremos la función de densidad de probabilidad, su media y varianza. De forma similar a las variables aleatorias discretas, definiremos la función de distribución de probabilidad.


## Variables aleatorias continuas

En el capítulo pasado usamos las probabilidades de variables aleatorias discretas para definir la función de masa de probabilidad $$f(x)=P(X= x)$$ 

Donde la probabilidad de que la variable aleatoria tome el valor $x$ la entendemos como el valor de su frecuencia relativa, cuando el número de repeticiones del experimiento aleatorio tiende a infinito. 

Cuando hablamos de datos continous  vimos que teníamos que  transformarlos en variables discretas (bins) para producir tablas de frecuencias relativas o histogramas. Veamos cómo definir las probabilidades de las variables continuas teniendo en cuenta estas particiones.  

**Ejemplo (misofonía)**

Reconsideremos el ángulo de convexidad de los pacientes con misofonía (Sección 2.21). El ángulo de convexidas de 123 pacientes fue medido. Entendimos cada medición como el resultado de un experimento aleatorio que repetimos 123 veces y que podíamos describir en una tabla de frecuencias o en un histograma.

Para hacer esto, redefinimos los resultados como pequeños intervalos regulares (bins) y calculamos la frecuencia relativa de cada intervalo.


```{r, echo=FALSE}
data <- read.delim("./data/data_0.txt")

disangulo <- cut(data$Angulo_convexidad, 5, include.lowest=TRUE)

tb <- table(disangulo)
df <- data.frame(outcome=names(tb), frequency=as.vector(tb)) 
rownames(df) <- paste0("n",1:length(tb))
tb2 <- prop.table(table(disangulo))
df <- data.frame(outcome=names(tb), ni=as.vector(tb), fi=as.vector(tb2)) 
df
```

## frecuencias relativas

Por lo tanto, definimos la probabilidad de observar un intervalo $i$ como la frecuencia relativa del intervalo cuando $N \rightarrow \infty$

$$ f_i =\frac{ n_ i }{ N} \rightarrow P( x_i \leq X \leq x_i + \Delta x)$$

Esta probabilidad depende de la longitud de los bins $\Delta x$. 

Si hacemos los bins cada vez más pequeños, las frecuencias se hacen más pequeñas y, por lo tanto,

$$P(x_i \leq X \leq x_i + \Delta x) \rightarrow 0$$ cuando $\Delta x \rightarrow 0$ porque $n_i \rightarrow 0$

Veamos cómo las frecuencias relativas se hacen más pequeñas cuando dividimos el rango de $X$ en $20$ bins  


```{r, echo=FALSE}
data <- read.delim("./data/data_0.txt")

disangulo <- cut(data$Angulo_convexidad, 20, include.lowest=TRUE)

tb <- table(disangulo)
df <- data.frame(outcome=names(tb), frequency=as.vector(tb)) 
rownames(df) <- paste0("n",1:length(tb))
tb2 <- prop.table(table(disangulo))
df <- data.frame(outcome=names(tb), ni=as.vector(tb), fi=as.vector(tb2)) 
df
```

## función de densidad de probabilidad


Definimos una cantidad en un punto $x$ que es **la probabilidad por unidad de distancia** de que una observación esté en el bin **infinitesimal**  entre $x$ y $x+dx$

$$f(x)= \frac{ P(x\leq X \leq x+dx )}{dx}$$

$f(x)$ se llama la **función de  densidad de probabilidad**.

Por lo tanto, la probabilidad de observar $X$ entre $x$ y $x+dx$
está dada por

$$P( x\leq X \leq x+dx )= f(x) dx$$

**Definición**

Para una variable aleatoria continua $X$, una función de **densidad de probabilidad** es tal que

1) Es positiva:

$$f(x) \geq 0$$


2) La probabilidad de observar **cualquier** valor de $x$ es 1:


$$\int_{-\infty}^{\infty} f(x) dx = 1$$

3) La probabilidad de observar un valor dentro de un intervalo es el **área bajo la curva**:

$$ P( a\leq X \leq b)=\int_{a}^{b} f(x) dx$$


Las propiedades aseguran que $f(x)dx$ satisfacen las propiedades de probabilidad de Kolmogorov.

La función de densidad de probabilidad es un paso más en la abstracción de probabilidades en la que añadimos el límite continuo


$$dx \rightarrow 0$$ 

Todas las propiedades de las probabilidades se traducen en términos de densidades y por lo tanto cambiamos sumatorios por integrales

$$\sum \rightarrow \int$$ 


Las densidades de probabilidad son cantidades matemáticas que no necesariamente representan experimientos aleatorios. 

Un interés fundamental en estadística es describir las densidades que describen nuestro experimento aleatorio concreto.



## Área total bajo la curva

**Ejemplo (gotas de lluvia)**

tomemos una **densidad de probabilidad** que podría describir la variable aleatoria que mide dónde cae una gota de lluvia en una canaleta de $100$ cm de longitud.



\[
    f(x)= 
\begin{cases}
    \frac{1}{100},& \text{si } x\in (0,100)\\
    0,& de\, otra\, forma 
\end{cases}
\]

Verifiquemos que la función satisface las tres propiedades de una densidad de probabilidad.

1) es evidente a partir de la definición que $f(x) \geq 0$


2) La probabilidad de observar **cualquier valor** de $X$ es el **área total bajo la curva**

$P( -\infty \leq X \leq \infty )= \int_{-\infty }^{\infty } f(x) dx = 100*0.01= 1$


```{r, echo=FALSE, warning=FALSE}
x <- 0:100
P <- rep(1,101)/100
plot(x, P, type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-20, 120), ylim=c(0,0.012))

lines(c(-20, 0), c(0, 0), col="black", lwd=2)
lines(c(100, 120), c(0, 0), col="black", lwd=2)


lines(c(x[1], x[1]), c(0, P[1]), col="black", lwd=2)

for(i in 2:length(x))
{lines(c(x[i], x[i]), c(0, P[i]), col="red")}

lines(c(x[i], x[i]), c(0, P[i]), col="black", lwd=2)
```


3) La probabilidad de observar $X$ en un intervalo es el **área bajo la curva** dentro del intervalo

- $P( 20 \leq X \leq 60) = \int_{20}^{60} f(x) dx = (60-20)*0.01=0.4$

```{r, echo=FALSE, warning=FALSE}
x <- 0:100
P <- rep(1,101)/100
plot(x, P, type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-20, 120), ylim=c(0,0.012))

lines(c(-20, 0), c(0, 0), col="black", lwd=2)
lines(c(100, 120), c(0, 0), col="black", lwd=2)

lines(c(x[1], x[1]), c(0, P[1]), col="black", lwd=2)

for(i in 20:60)
{lines(c(x[i], x[i]), c(0, P[i]), col="red")}

lines(c(x[101], x[101]), c(0, P[100]), col="black", lwd=2)
```


## Probabilidades de variables continuas

Para variables continuas, calculamos la probabilidad de que la variable esté en un intervalo dado. Eso es

$$P( a \leq X \leq b)$$
Recordemos que para variables continuas, la probabilidad de que el experimento nos dé un número real particular es cero: $P(X= a)= 0$

La probabilidad $P( a \leq X \leq b)$ es el área bajo la curva de $f(x)$ entre $a$ y $b$

- $P( a \leq X \leq b) = \int_{a}^{b} f(x) dx$


```{r, echo=FALSE, warning=FALSE}
x <- seq(-4,8,0.05)
P <- function(x){0.7*dnorm(x)+0.3*dnorm(x,3)}

plot(x, P(x), type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-4, 8), ylim=c(0,0.4))

for(i in which(x==0):which(x==2))
{lines(c(x[i], x[i]), c(0, P(x[i])), col="red")}

```


## Distribución de probabilidad

La **distribución de probabilidad** $F(c)$ definida como la acumulación de probabilidad hasta el resultado $C$

$F(c) = P( X \leq c)$

se puede utilizar para calcular la probabilidad $P( a \leq X \leq b)$.

Si consideramos que:

1) la probabilidad acumulada hasta $b$ está dada por

- $F(b) = P( X \leq b)=\int_{-\infty }^bf(x)dx$



```{r, echo=FALSE, warning=FALSE}
x <- seq(-4,8,0.05)
P <- function(x){0.7*dnorm(x)+0.3*dnorm(x,3)}

plot(x, P(x), type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-4, 8), ylim=c(0,0.4))

for(i in 1:which(x==2))
{lines(c(x[i], x[i]), c(0, P(x[i])), col="red")}

```

2) la probabilidad acumulada hasta $a$ es

- $F(a) = P( X \leq a)$


```{r, echo=FALSE, warning=FALSE}
x <- seq(-4,8,0.05)
P <- function(x){0.7*dnorm(x)+0.3*dnorm(x,3)}

plot(x, P(x), type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-4, 8), ylim=c(0,0.4))

for(i in 1:which(x==0))
{lines(c(x[i], x[i]), c(0, P(x[i])), col="blue")}

```

Entonces, la probabilidad entre $a$ y $b$ viene dada por la diferencia en el valor de la distribución de probabilidad

- $P( a\leq X \leq b) = \int_a^b f(x)dx=F(b)-F(a)$


```{r, echo=FALSE, warning=FALSE}
x <- seq(-4,8,0.05)
P <- function(x){0.7*dnorm(x)+0.3*dnorm(x,3)}

plot(x, P(x), type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-4, 8), ylim=c(0,0.4))

for(i in 1:which(x==2))
{lines(c(x[i], x[i]), c(0, P(x[i])), col="red")}


for(i in 1:which(x==0))
{lines(c(x[i], x[i]), c(0, P(x[i])), col="blue")}

```

**Definición**

La **distribución de probabilidad** de una variable aleatoria continua se define como

$$F(a)= P( X\leq a) =\int_{-\infty } ^af(x)dx$$

y tiene las siguientes propiedades:

1) Está entre $0$ y $1$:

$$F(-\infty )= 0\,\, y \,\,F(\infty )=1$$

2) Siempre aumenta:

$$F(a)\leq F(b)$$

si $a \leq b$

3) Se puede utilizar para calcular probabilidades:

$$P( a \leq X \leq b)=F(b)-F(a)$$

4) Recupera la densidad de probabilidad:

$$f(x)=\frac{ dF (x )}{ dx}$$

Usamos **distribuciones de probabilidad** para **calcular probabilidades** de una variable aleatoria dentro de intervalos, y su derivada es la función de densidad de probabilidad.

**Ejemplo (gotas de lluvia)**

Para la función de densidad uniforme:


\[
    f(x)= 
\begin{cases}
    \frac{1}{100},& \text{si } x\in (0,100)\\
    0,& de\, otra\, forma 
\end{cases}
\]

Encontramos que la distribución de probabilidad es 

\[
    F(a)= 
\begin{cases}
    0,& \text{si } a \leq 0 \\
    \frac{a}{100},& \text{si } a\in (0,100)\\
    1, & \text{si } 100 \leq a \\
    \\
\end{cases}
\]


\newpage


## Gráficas de probabilidad

1) Podemos dibujar la probabilidad de una variable aleatoria en un intervalo como el *área* bajo la curva de la **densidad**. Por ejemplo

$$P(20<X< 60)$$


```{r, echo=FALSE, warning=FALSE}
x <- 0:100
P <- rep(1,101)/100
plot(x, P, type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-20, 120), ylim=c(0,0.012))

lines(c(-20, 0), c(0, 0), col="black", lwd=2)
lines(c(100, 120), c(0, 0), col="black", lwd=2)

lines(c(x[1], x[1]), c(0, P[1]), col="black", lwd=2)

for(i in 20:60)
{lines(c(x[i], x[i]), c(0, P[i]), col="red")}

lines(c(x[101], x[101]), c(0, P[100]), col="black", lwd=2)
```


2) También podemos dibujar la probabilidad $P(20<X< 60)$ como la *diferencia* en los valores de la **distribución**



```{r, echo=FALSE, warning=FALSE}
x <- -20:120
F <- function(x){
  out <-  x/100
  out[x<0] <- 0
  out[x>100] <- 1
  out

  }


plot(x, F(x), type="lines",col="black", ylab="F(a)", xlab="a", lwd=2, xlim=c(-20, 120), ylim=c(0,1))

lines(c(20, 20), c(0, F(20)), col="black", lty=2)
lines(c(60, 60), c(0, F(60)), col="black", lty=2)

lines(c(-40, 20), c(F(20), F(20)), col="black", lty=2)
lines(c(-40, 60), c(F(60), F(60)), col="black", lty=2)

lines(c(-20, -20), c(F(20), F(60)), col="red", lwd=2)

text(7.5, 0.4, "P(20<X<60) = F(60)-F(20)")

```

## Media

Como en el caso discreto, la **media** mide el centro de masa de las probabilidades

**Definición**

Supongamos que $X$ es una variable aleatoria continua con función de probabilidad **densidad** $f(x)$. El valor medio o esperado de $X$, denotado como $\mu$ o $E(X)$, es


$$\mu=E(X)=\int_{-\infty}^\infty x f(x) dx$$

Es la versión continua del centro de gravedad.

**Ejemplo (gotas de lluvia)**

La variable aleatoria con densidad de probabilidad


\[
    f(x)= 
\begin{cases}
    \frac{1}{100},& \text{si } x\in (0,100)\\
    0,& de\, otra\, forma 
\end{cases}
\]


Tiene un valor esperado en

$$E(X)=50$$





```{r, echo=FALSE, warning=FALSE}
x <- 0:100
P <- rep(1,101)/100
plot(x, P, type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-20, 120), ylim=c(-0.0001,0.012))

lines(c(-20, 0), c(0, 0), col="black", lwd=2)
lines(c(100, 120), c(0, 0), col="black", lwd=2)

points(50,-0.0001, pch=17, bg="black")

lines(c(x[1], x[1]), c(0, P[1]), col="black", lwd=2)

lines(c(x[101], x[101]), c(0, P[100]), col="black", lwd=2)

for(i in 2:length(x))
{lines(c(x[i], x[i]), c(0, P[i]), col="red")}

abline(v=50, lty=2)

```


## Varianza

Como en el caso discreto, la varianza mide la dispersión de probabilidades sobre la media

**Definición**

Supongamos que $X$ es una variable aleatoria continua con función de densidad de probabilidad $f(x)$. La varianza de $X$, denotada como $\sigma^2$ o $V(X)$, es


$$\sigma^2=V(X)=\int_{-\infty}^\infty (x-\mu)^2 f(x) dx$$

Es la versión continua del momento de inercia.


## Funciones de $X$

En muchas ocasiones, estaremos interesados en resultados que sean función de las variables aleatorias. Tal vez nos interese el cuadrado de la elongación de un muelle, o la raíz cuadrada de la temperatura de un motor.

**Definición**

Para cualquier función $h$ de una variable aleatoria $X$, con función de masa $f(x)$, su valor esperado viene dado por


$$E[h(X)]= \int_{-\infty}^{\infty} h(x) f(x)dx$$
De esta definición recuperamos las mismas propiedades que en el caso discreto

1) La media de una función lineal es la función lineal de la media: $$ E( a\times X +b)= a\times E(X) +b$$ para $a$ y $b$ escalares.


2) La varianza de una función lineal de $X$ es:

$$V(a\times X +b)= a^2\times V(X)$$

3) La varianza sobre el origen es la varianza sobre la media más la media al cuadrado: 

$$E(X^2)= V(X)+E(X)^2$$


## Ejercicios

#### Ejercicio 1

Para la densidad de probabilidad



\[
    f(x)= 
\begin{cases}
    \frac{1}{100},& \text{si } x\in (0,100)\\
    0,& de\, otra\, forma 
\end{cases}
\]

- calcular la media (R:50)
- calcular la varianza usando $E(X^2)= V(X)+E(X)^2$ (R:100^2/12)
- calcula $P( \mu-\sigma \leq X \leq \mu+\sigma)$ (R: 0.57)
- ¿Cuáles son el primer y tercer cuartiles? (R: 25; 75)




```{r, echo=FALSE, warning=FALSE}
x <- 0:100
P <- rep(1,101)/100
plot(x, P, type="line",col="black", ylab="f(x)", lwd=2, xlim=c(-20, 120), ylim=c(-0.0001,0.012))

lines(c(-20, 0), c(0, 0), col="black", lwd=2)
lines(c(100, 120), c(0, 0), col="black", lwd=2)

points(50,-0.0001, pch=17, bg="black")

lines(c(x[1], x[1]), c(0, P[1]), col="black", lwd=2)

lines(c(x[101], x[101]), c(0, P[100]), col="black", lwd=2)

for(i in which(x==21):which(x==79))
{lines(c(x[i], x[i]), c(0, P[i]), col="red")}

abline(v=50, lty=2)

lines(c(50-28.86751, 50+28.86751), c(0.005,0.005), lwd=2, col="blue")

```


#### Ejercicio 2

Dado

\[
    f(x)= 
\begin{cases}
0, & x < 0 \\
ax, & x \in [0,3] \\
b, & x \in (3,5) \\
\frac{b}{3}(8-x),& x \in [5,8]\\
0, & x > 8 \\
\end{cases}
\]


- ¿Cuáles son los valores de $a$ y $b$ tales que $f(x)$ es una función de densidad de probabilidad continua ? (R: 1/15; 1/5)

- ¿Cuál es la media de $X$? (R:4)



#### Ejercicio 3

Para la densidad de probabilidad


\[
    f(x)= 
\begin{cases}
    \lambda e^{-\lambda x},& \text{si } x \geq 0\\
    0,& de\, otra\, forma 
\end{cases}
\]

- Confirmar que se trata de una densidad de probabilidad
- Calcular la media (R: 1/$\lambda$)
- Calcule el valor esperado de $X^2$ (R: 2/$\lambda^2$)
- Calcular la varianza (R: 1/$\lambda^2$)
- Hallar la distribución de probabilidad $F(a)$ (R: $1- exp( -\lambda a)$)
- Encuentra la mediana (R: $\log{ 2}$ /$\lambda$)

#### Ejercicio 4

Dada la distribución acumulativa de una variable aleatoria $X$


\[
    F(x)= 
\begin{cases}
0, & x  < -1 \\
\frac{1}{80}(17+16x-x^2),& x \in [-1,7)\\
1,& x \geq 7\\
\end{cases}
\]

calcular:

- $P(X> 0)$ (R:63/80)
- $E(X)$ (R:1.93)
- $P(X>0|X< 2)$ (R:28/45)



