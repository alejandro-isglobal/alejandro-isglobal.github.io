---
title: "Intervalos de Confianza"
output: html_document
---

Los intervalos de confiaza son herramientas básicas de la inferencia estadística y como tal se calculan fácilmente en R. A pesar de lo fácil que es calcularlos y de su uso extendido, frecuentemente son malinterpretados. Esto tal vez se deba a que rara vez nos adentramos a las razones del por qué y el cómo de su definición, prefiriendo saltar rápidamente a su aplicación. Usemos R para intentar entenderlos un poco mas. 

Consideremos un proceso de producción de altavoces de $4\Omega$. Para su posible producción en serie, se quiere saber en la impedancia promedio los altavoces, por lo que se han creado 10 prototipos. De estos diez prototipos queremos saber en qué medida su impedancia promedio estima la impedancia del proceso.  

El resultado de medir la impedancia de los 10 altavoces es:

| Medición| Impedancia |  
| --- |--- | 
| $x_1$ | 3.889533 |  
| $x_2$ | 4.800898 |  
| $x_3$ | 4.262898 | 
| $x_4$ | 4.361508 |
| $x_5$ | 5.617505 |
| $x_6$ | 3.423186 | 
| $x_7$ | 3.575229 | 
| $x_8$ | 6.961411 |
| $x_9$ | 3.833203 | 
| $x_{10}$ | 3.560329 | 

codificamos estas mediciones en el vector **impedancia**


```{r}
impedancia <- c(3.889533, 4.800898, 4.262898, 4.361508, 
5.617505, 3.423186, 3.575229, 6.961411, 3.833203, 
3.560329)
```
y calculamos el promedio de la mediciones defido como 
$$\bar{x}=\sum_{i=1,...n} x_i$$

usando la función **mean**
```{r}
barx <- mean(impedancia)
barx
```

Si bien el promedio está se cerca del objetivo de $4\Omega$ si tomásemos otras 10 mediciones este valor cambiaría y podría alejarse de este valor. 

¿Qué tan confiados  estamos de que el valor 4.42857 es representativo del proceso de producción? para tal vez mejorarlo y estar mas cerca de $4\Omega$.  

Consideremos que:

- tenemos *n* valores como resulatado de *n* mediciones $(x_1,...,x_n)$ en minúsculas, que provienen de las variables aleatorias $(X_i,...X_n)$, en mayúsculas, que son *n* mediciones de la misma varibale aleatoria $X=X_i=...=Xn$.

- tenemos *un* valor para la media muestral 
$\bar{x}= 4.42857$, que proviene de **otra** variable aleatoria 
$$\bar{X}= \frac{1}{n} \sum X_i$$

Por lo tanto debemos considerar dos distribuciones de probabilidad. La  primera para las mediciones $X$. La llamamos la distribución poblacional, para la que asumimos modelos de probabilidad, como por ejemplo distribuciones binomial o Poisson, para variables aleatorias discretas, y normal o exponencial para variables aleatorias continuas; entre muchas otras.  La segunda distribución es para $\bar{X}$, que intentamos averiguar desde los modelos para $X$, aplicando en teorema central del límite o derivándola analíticamente, como es el caso de la distribucion t-student.


Queremos conocer el valor esperado de las mediciones $\mu=E(X)$, que en nuestro ejemplo es el valor medio de la impedacia para el proceso de fabricación de los altavoces. $\mu$ es un parámetro de la distribución de $X$ que nunca lo observamos directamente pero que si asumimos un modelo para la distribución podemos estimarlo de los datos. El número $\bar{x}$ es un ejemplo de un número derivado de los datos que podemos usar para estimar $\mu$, ya que en particular $E(\bar{X})=E(X)$.

Al hacer la estimación tomamos $\mu \sim \bar{x}$ ($\hat{\mu} = \bar{x}$). Sin embargo, no sabemos **qué tan cerca** estamos de $\mu$. Esta es la motivación para los intervalos de confianza. Para tener una idea de donde está $\mu$.


Busquemos los números $f_{inf}$ y $f_{sup}$ tal que

$$P(f_{inf} \leq \bar{X} - \mu \leq  f_{sup} )=0.95$$

O sea los valores que contienen al 95\% de las diferencias entre $\bar{X}$ y $\mu$.

Escribamos esta proabilididad como:
$$P(\bar{X} - f_{sup} \leq \mu \leq \bar{X} - f_{inf} )=0.95$$

Y definimos el **intervalo aleatorio** 
$$(L,U) = (\bar{X} - f_{sup},\bar{X} - f_{inf})$$ 
este intervalo tiene por definición una probailidad del  95\% de contener a $\mu$. Cada vez que hagamos un experimento de *n* mediciones y tomemos su promedio tendremos un intervalo. El intervalo asociado a un experimento $(l,u)=(\bar{x} - f_{sup},\bar{x} - f_{inf})$, en minúsculas, o contiene o no contiene a $\mu$ pero eso **no lo sabemos**. Lo que sabemos es que el 95\% de este tipo de intervalos contienen a $\mu$. Tenemos pues una confianza del 95\% de que el intervalo $(l,u)$ que obtenemos de un experimento contiene $\mu$, y una probabilidad del 95\% de que el intervalo aleatorio contenga a $\mu$. La confianza es una propiedad de una medición mientras que la probabilidad de una variable aleatoria. 


Volvamos a la probabilidad incial  
$$P(f_{inf} \leq \bar{X} - \mu \leq  f_{sup} )=0.95$$
y dividamos por $\sigma_{\bar{X}}$
$$P( \frac{f_{inf}}{\sigma_{\bar{X}}} \leq \frac{\bar{X}-\mu}{\sigma_{\bar{X}}} \leq  \frac{f_{sup}}{\sigma_{\bar{X}}} )=0.95$$

remplazemos $\sigma_{\bar{X}}=\sigma_{X}/\sqrt{n}$

$$P( \frac{f_{inf}}{\sigma_{X}/\sqrt{n}} \leq \frac{\bar{X}-\mu}{\sigma_{X}/\sqrt{n}} \leq  \frac{f_{sup}}{\sigma_{X}/\sqrt{n}} )=0.95$$
Para calular $f_{inf}$ y $f_{sup}$ asumimos 2 

1. Que $X$ se distribye normalmente $N(\mu, \sigma)$ 

2. Que sabemos (o nos dan) $\sigma_{X}$ como información adicional. Por ejemplo el fabricante sabe que la desviación estándard de los altavoces que produce es $\sigma_X=1.4 \Omega$  


Si 1 y 2 se cumples **entonces** $Z=\frac{\bar{X}-\mu}{\sigma_{X}/\sqrt{n}}$ es una variable aleatoria estandard $N(\mu=0, \sigma^2=1)$:
$$P( z_{0.025} \leq Z \leq  z_{0.975} )=0.95$$
Podemos pues calcular  $f_{inf}$ y $f_{sup}$ de los cuantiles de $Z$
o sea:
$$f_{inf}=z_{0.025}*\sigma_{X}/\sqrt{n}$$
$$f_{sup}=z_{0.925}*\sigma_{X}/\sqrt{n}$$

que podemos calcular en R con la funcion de cuantiles para la distribucion estándard
```{r}
z0.025 <- qnorm(0.025)
z0.025 
z0.925 <- qnorm(0.925)
z0.925 
```


Para nuestro experimento, tenemos n=10 y $\sigma_{X}=1.4cm$ y $f_{inf}=-f_{sup}$, porque la distribución estandard es simétrica 
```{r}
fsup <- 1.959964*1.4/sqrt(10)
fsup
```

Entonces para el intervalo aleatorio 

$$(L,U) = (\bar{X} - f_{sup},\bar{X} - f_{inf})$$

hemos hecho la observación 

$$(l,u) = (\bar{x} - f_{sup},\bar{x} + f_{sup})$$

```{r}
CI <- c(barx-fsup,barx+fsup)
CI
```


El intervalo $(l,u)=c(3.503469, 5.353670)$ es una observación de (L,U) y para la cual tenemos una confianza del 95\% de haber atrapado a $\mu$.

Esto también lo escribimos como:

$$\bar{x}=4.4 \pm 0.8$$

O sea que al estimar $\mu$ con $\bar{x}$, no podemos estar muy seguros de la precisión dada por el decimal $.4$. Los decimales siguientes carecen de confianza y los podemos descartar. Como conclusión tenemos que el proceso de altavoces incluye los $4\Omega$ pero es claramente variable y se debe valorar si esta variación es aceptable. 

----

Los intervalos de confianza para 

- un experimento de n muestras.
- de una distribución normal para $X$.
- del que sabemos la desviación estándard para $X$: $\sigma_X$.
\end{itemize}

se pueden calcular con la función {\bf z.test} del paquete TeachingDemos

```{r}
library(TeachingDemos) 
z.test(impedancia, sd=1.4)
```

##Intervalos de confianza cuando $\sigma_X$ es desconocido
El caso más común es que no sepamos ni la media $E(X)=\mu$ ni la varianza $V(X)=\sigma^2_X$ de las mediciones. 

Recordemos que queremos:

$$P( \frac{f_{inf}}{\sigma_{X}/\sqrt{n}} \leq \frac{\bar{X}-\mu}{\sigma_{X}/\sqrt{n}} \leq  \frac{f_{sup}}{\sigma_{X}/\sqrt{n}} )=0.95$$

Ahora para calcular  $f_{inf}$ y $f_{sup}$ asumimos

1. que $\bar{X}$ es una distribución normal $N(\mu, \sigma^2)$

2. que podemos sustituir $\sigma_x$ por su estimador $s=\frac{1}{n-1} \Sigma_i(x_i -\bar{x})^2$, calculado de los datos. 

Si 1 y 2 se cumples **entonces** la variable $T=\frac{\bar{X}-\mu}{s/\sqrt{n}}$ es una variable aleatoria que sigue una distibucion t-student con n-1 grados de libertad $t(n-1)$.


$$P( \frac{f_{inf}}{s/\sqrt{n}} \leq \frac{\bar{X}-\mu}{s/\sqrt{n}} \leq  \frac{f_{sup}}{s/\sqrt{n}} )=0.95$$

$$P( t_{0.025,n-1} \leq T \leq  t_{0.975,n-1} )=0.95$$
siendo $T$ una variable aleatoria con una dostribuci\'on student-t con n-1 grados de libertad

```{r}
t0.025 <- qt(0.025,df=9)
t0.025
t0.975 <- qt(0.975,df=9)
t0.975
```
$$f_{sup}=t_{0.975,n-1} \frac{s}{\sqrt{n}}=-f_{inf}$$
Para nuestro experimento de altavoces
```{r}
barx <- mean(impedancia)
barx
s <-sd(impedancia)
s
```
 y por lo tanto el intervalo de confianza al 95\% es 
```{r}
fsup <- 2.262157*s/sqrt(10)
fsup
CI <- c(barx-fsup,barx+fsup)
CI
```

Este intervalo se calcula con la función {\bf t.test}

```{r}
 t.test(impedancia, conf.level = 0.95)
```

Donde vemos claramente el intervalo de confianza y el valor para $\bar{x}$